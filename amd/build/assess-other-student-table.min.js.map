{"version":3,"file":"assess-other-student-table.min.js","sources":["../src/assess-other-student-table.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * This is a table with nested tables in rows: http://tabulator.info/examples/4.9#nested-tables\n *\n * @module   local_cltools/assess-student-table.js\n * @copyright 2021 - CALL Learning - Laurent David <laurent@call-learning.fr>\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport $ from 'jquery';\nimport {tableInit} from \"local_cltools/local/table/dynamic\";\n\n// Same as in the usual dynamic but as we are not paginating, we send the whole data.\nconst ajaxSubtableResponseProcessorData = function (url, params, response) {\n    return response.data.map(\n        (rowstring) => JSON.parse(rowstring)\n    );\n};\n\nexport const init = async (tabulatorelementid) => {\n    const tableelement = $(\"#\" + tabulatorelementid);\n    const tableUniqueid = tableelement.data('tableUniqueid');\n    const rowFormatter = (row) => {\n        const holderEl = document.createElement(\"div\");\n        const tableEl = document.createElement(\"div\");\n        holderEl.appendChild(tableEl);\n        const id = row.getData().id;\n        row.getElement().appendChild(holderEl);\n        holderEl.setAttribute('class', \" ceveteval-subtable appraisalSubtable\" + id + \"\");\n\n        const filters = {\n            jointype: 2,\n            filters: {\n                appraisalid: {\n                    name: \"appraisalid\", jointype: 2, values:\n                        [JSON.stringify({direction: \"==\", value: id})],\n                    type: \"numeric_comparison_filter\"\n                }\n            }\n        };\n        tableInit(\n            tableEl,\n            'local_cveteval\\\\local\\\\assessment\\\\appraisals_criteria',\n            tableUniqueid + id.toString(),\n            0,\n            filters,\n            () => null,\n            {\n                pagination: false,\n                dataTree: true,\n                ajaxFiltering: false,\n                ajaxSorting: false,\n                paginationDataReceived: false,\n                layout: \"fitColumns\",\n                ajaxResponse: ajaxSubtableResponseProcessorData\n            }\n        );\n    };\n    tableInit(\"#\" + tabulatorelementid,\n        tableelement.data('tableHandler'),\n        tableUniqueid,\n        tableelement.data('table-pagesize'),\n        tableelement.data('tableFilters'),\n        (e, row) => {\n            const id = row.getData().id;\n            if (e.target.className === \"tabulator-cell\") {\n                $(\".appraisalSubtable\" + id + \"\").toggle();\n            }\n        },\n        {\n            rowFormatter: rowFormatter,\n            selectable: true,\n            resizableColumns: false,\n            layout: \"fitColumns\",\n            minHeight: \"400px\"\n        }\n    );\n};\n"],"names":["ajaxSubtableResponseProcessorData","url","params","response","data","map","rowstring","JSON","parse","init","tabulatorelementid","tableelement","tableUniqueid","rowFormatter","row","holderEl","document","createElement","tableEl","appendChild","id","getData","getElement","setAttribute","filters","jointype","appraisalid","name","values","stringify","direction","value","type","toString","pagination","dataTree","ajaxFiltering","ajaxSorting","paginationDataReceived","layout","ajaxResponse","e","target","className","toggle","selectable","resizableColumns","minHeight"],"mappings":"qgBA0BMA,kCAAoC,SAAUC,IAAKC,OAAQC,iBACtDA,SAASC,KAAKC,KACjB,SAACC,kBAAcC,KAAKC,MAAMF,eAIrBG,kCAAO,iBAAOC,qKACjBC,cAAe,mBAAE,IAAMD,oBACvBE,cAAgBD,aAAaP,KAAK,iBAClCS,aAAe,SAACC,SACZC,SAAWC,SAASC,cAAc,OAClCC,QAAUF,SAASC,cAAc,OACvCF,SAASI,YAAYD,aACfE,GAAKN,IAAIO,UAAUD,GACzBN,IAAIQ,aAAaH,YAAYJ,UAC7BA,SAASQ,aAAa,QAAS,wCAA0CH,QAEnEI,QAAU,CACZC,SAAU,EACVD,QAAS,CACLE,YAAa,CACTC,KAAM,cAAeF,SAAU,EAAGG,OAC9B,CAACrB,KAAKsB,UAAU,CAACC,UAAW,KAAMC,MAAOX,MAC7CY,KAAM,sDAKdd,QACA,yDACAN,cAAgBQ,GAAGa,WACnB,EACAT,SACA,kBAAM,OACN,CACIU,YAAY,EACZC,UAAU,EACVC,eAAe,EACfC,aAAa,EACbC,wBAAwB,EACxBC,OAAQ,aACRC,aAAcxC,4DAIhB,IAAMU,mBACZC,aAAaP,KAAK,gBAClBQ,cACAD,aAAaP,KAAK,kBAClBO,aAAaP,KAAK,iBAClB,SAACqC,EAAG3B,SACMM,GAAKN,IAAIO,UAAUD,GACE,mBAAvBqB,EAAEC,OAAOC,+BACP,qBAAuBvB,IAASwB,WAG1C,CACI/B,aAAcA,aACdgC,YAAY,EACZC,kBAAkB,EAClBP,OAAQ,aACRQ,UAAW"}